var I=Object.defineProperty;var _=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var F=(i,t,e)=>t in i?I(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,f=(i,t)=>{for(var e in t||(t={}))b.call(t,e)&&F(i,e,t[e]);if(_)for(var e of _(t))k.call(t,e)&&F(i,e,t[e]);return i};import{_ as o,c as p,A,r as y,B as $}from"./bi.126.82.js";const P=(i,t,e,d,r,n,a,s,l)=>{let c=f({},t);if(a){const g=f({},s);g[i.target.name]="",l(f({},g))}switch(c[i.target.name]=i.target.value,i.target.name){case"listId":c=D(c,d,e,r,n);break}e(f({},c))},E=i=>!((i!=null&&i.address_field?i.address_field.filter(e=>!e.formField&&e.mailChimpAddressField&&e.required):[]).length>0),D=(i,t,e,d,r)=>{var a,s,l,c;const n=A(i);return n.field_map=[{formField:"",mailChimpField:""}],console.log((s=(a=n==null?void 0:n.default)==null?void 0:a.fields)==null?void 0:s[i.listId]),(c=(l=n==null?void 0:n.default)==null?void 0:l.fields)!=null&&c[i.listId]||(R(t,n,e,d,r),q(t,n,e,d,r)),n},O=(i,t,e,d,r)=>{d(!0);const n={formID:i,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails};p(n,"mChimp_refresh_audience").then(a=>{if(a&&a.success){const s=f({},t);s.default||(s.default={}),a.data.audiencelist&&(s.default.audiencelist=a.data.audiencelist),a.data.tokenDetails&&(s.tokenDetails=a.data.tokenDetails),r({show:!0,msg:o("Audience list refreshed","bit-integrations")}),e(f({},s))}else a&&a.data&&a.data.data||!a.success&&typeof a.data=="string"?r({show:!0,msg:y(o("Audience list refresh failed Cause: %s. please try again","bit-integrations"),a.data.data||a.data)}):r({show:!0,msg:o("Audience list failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},R=(i,t,e,d,r)=>{d(!0);const n={formID:i,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,listId:t.listId};p(n,"mChimp_refresh_tags").then(a=>{if(a&&a.success){const s=f({},t);a.data.audienceTags&&(s.default.audienceTags=a.data.audienceTags),r({show:!0,msg:o("Audience tags refreshed","bit-integrations")}),e(f({},s))}else a&&a.data&&a.data.data||!a.success&&typeof a.data=="string"?r({show:!0,msg:y(o("Audience tags refresh failed Cause: %s. please try again","bit-integrations"),a.data.data||a.data)}):r({show:!0,msg:o("Audience tags failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},q=(i,t,e,d,r)=>{const{listId:n}=t;if(!n)return;d(!0);const a={formID:i,listId:n,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails};p(a,"mChimp_refresh_fields").then(s=>{s&&s.success?e(l=>$(l,c=>{s.data.audienceField&&(c.default.fields||(c.default.fields={}),c.default.fields[n]=s.data.audienceField,c.field_map=v(s.data.audienceField)),s.data.tokenDetails&&(c.tokenDetails=s.data.tokenDetails),r({show:!0,msg:o("Fields refreshed","bit-integrations")})})):r({show:!0,msg:o("Fields refresh failed. please try again","bit-integrations")}),d(!1)}).catch(()=>d(!1))},U=i=>{const t={},d=window.location.href.replace(`${window.opener.location.href}`,"").split("&");d&&d.forEach(r=>{const n=r.split("=");n[1]&&(t[n[0]]=n[1])}),localStorage.setItem(`__${i}`,JSON.stringify(t)),window.close()},W=(i,t,e,d,r,n,a,s)=>{if(!e.clientId||!e.clientSecret){r({clientId:e.clientId?"":o("Client ID cann't be empty","bit-integrations"),clientSecret:e.clientSecret?"":o("Secret key cann't be empty","bit-integrations")});return}a(!0);const l=`https://login.mailchimp.com/oauth2/authorize?client_id=${e.clientId}&redirect_uri=${encodeURIComponent(window.location.href)}&response_type=code`,c=window.open(l,i,"width=400,height=609,toolbar=off"),g=setInterval(()=>{if(c.closed){clearInterval(g);let u={},m=!1;const w=localStorage.getItem(`__${i}`);if(w&&(m=!0,u=JSON.parse(w),localStorage.removeItem(`__${i}`),u.code.search("#"))){const[h]=u.code.split("#");u.code=h}if(!u.code||u.error||!u||!m){const h=u.error?`Cause: ${u.error}`:"";s({show:!0,msg:`${o("Authorization failed","bit-integrations")} ${h}. ${o("please try again","bit-integrations")}`}),a(!1)}else{const h=f({},e);h.accountServer=u["accounts-server"],S(t,u,h,d,n,a,s)}}},500)},S=(i,t,e,d,r,n,a)=>{const s=f({},t);s.clientId=e.clientId,s.clientSecret=e.clientSecret,s.redirectURI=window.location.href,p(s,`${i}_generate_token`).then(l=>l).then(l=>{if(l&&l.success){const c=f({},e);c.tokenDetails=l.data,d(c),r(!0),a({show:!0,msg:o("Authorized Successfully","bit-integrations")})}else l&&l.data&&l.data.data||!l.success&&typeof l.data=="string"?a({show:!0,msg:`${o("Authorization failed Cause:","bit-integrations")}${l.data.data||l.data}. ${o("please try again","bit-integrations")}`}):a({show:!0,msg:o("Authorization failed. please try again","bit-integrations")});n(!1)})},J=i=>!((i.field_map?i.field_map.filter(e=>!e.formField&&!e.mailChimpField):[]).length>0),v=i=>{const t=i&&Object.values(i).filter(e=>e.required===!0);return t.length>0?t.map(e=>({formField:"",mailChimpField:e.tag})):[{formField:"",mailChimpField:""}]};export{R as a,q as b,W as c,E as d,J as e,P as h,O as r,U as s};
